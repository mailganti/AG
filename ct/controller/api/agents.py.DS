from fastapi import APIRouter, HTTPException, Header
import os
from controller.depends import require_admin

#agents_router = APIRouter()

@agents_router.get("/")
async def get_agents(x_admin_token: str = Header(...)):
    print("=== AGENTS API CALLED ===")
    print(f"Token received: {x_admin_token}")
    
    expected_token = os.environ.get("ADMIN_TOKEN")
    if not expected_token:
        raise HTTPException(status_code=500, detail="ADMIN_TOKEN not configured")
    
    if x_admin_token != expected_token:
        raise HTTPException(status_code=401, detail="Invalid token")
    
    # Return test data
    return {
        "message": "success",
        "data": [
            {
                "agent_name": "test-agent-1",
                "hostname": "localhost", 
                "port": 8080,
                "status": "online",
                "last_seen": "2023-01-01T00:00:00Z"
            }
        ]
    }

# Add other agent endpoints as needed
@agents_router.post("/")
async def create_agent(x_admin_token: str = Header(...)):
    # Your create agent logic
    return {"message": "Agent created"}
